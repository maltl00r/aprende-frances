<script src="js/progress.js"></script>
<script>
  async function loadCourse() {
    try {
      const response = await fetch('course.json');
      if (!response.ok) {
          throw new Error('No se pudo cargar el archivo course.json');
      }
      const course = await response.json();
      return course;
    } catch (error) {
      console.error("Error al cargar el curso:", error);
      return null;
    }
  }
  const params = new URLSearchParams(window.location.search);
  const modId = params.get('id');

  const title = document.getElementById('moduleTitle');
  const container = document.getElementById('videoContainer');
  const toggleBtn = document.getElementById('toggleModuleBtn');

  function renderModule(module) {
    if(!module){
      title.textContent = 'Módulo no encontrado';
      toggleBtn.style.display = 'none';
      return;
    }

    title.textContent = module.name;
    container.innerHTML = '';

    if(module.url){
      const iframe = document.createElement('iframe');
      iframe.src = module.url;
      iframe.frameBorder = '0';
      iframe.allowFullscreen = true;
      container.appendChild(iframe);
    }

    const state = Progress.getModuleState(module.id);
    if(state?.completed){
      toggleBtn.textContent = 'Módulo completado ✔️';
    } else {
      toggleBtn.textContent = 'Marcar módulo como completado';
    }
  }

  toggleBtn.addEventListener('click', () => {
    if(!module) return;
    const state = Progress.getModuleState(module.id);
    if(state?.completed){
      Progress.resetModule(module.id);
      alert('¡Módulo desmarcado!');
    } else {
      Progress.markCompleted(module.id);
      alert('¡Módulo completado!');
    }
    renderModule(module);
  });

  loadCourse().then(course => {
    if (course) {
      const module = course.modules.find(m => m.id === modId && m.type === 'video');
      renderModule(module);
    }
  });
</script>
</body>
</html>