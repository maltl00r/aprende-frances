<script src="js/progress.js"></script>
<script>
  async function loadCourse() {
    try {
      const response = await fetch('course.json');
      if (!response.ok) {
          throw new Error('No se pudo cargar el archivo course.json');
      }
      const course = await response.json();
      return course;
    } catch (error) {
      console.error("Error al cargar el curso:", error);
      return null;
    }
  }
  const params = new URLSearchParams(window.location.search);
  const modId = params.get('id');

  const title = document.getElementById('moduleTitle');
  const list = document.getElementById('audioList');
  const toggleBtn = document.getElementById('toggleModuleBtn');

  function renderModule(module) {
    if(!module){
      title.textContent = 'Módulo no encontrado';
      toggleBtn.style.display = 'none';
      return;
    }

    title.textContent = module.name;
    list.innerHTML = '';

    (module.items || []).forEach(item => {
      const wrapper = document.createElement('div');
      wrapper.className = 'audio-item module-card';
      wrapper.innerHTML = `
        <p class="module-name">${item.name}</p>
        <audio controls src="${item.file}"></audio>
      `;
      list.appendChild(wrapper);
    });

    const state = Progress.getModuleState(module.id);
    if(state?.completed){
      toggleBtn.textContent = 'Módulo completado ✔️';
    } else {
      toggleBtn.textContent = 'Marcar módulo como completado';
    }
  }

  toggleBtn.addEventListener('click', () => {
    if(!module) return;
    const state = Progress.getModuleState(module.id);
    if(state?.completed){
      Progress.resetModule(module.id);
      alert('¡Módulo desmarcado!');
    } else {
      Progress.markCompleted(module.id);
      alert('¡Módulo completado!');
    }
    renderModule(module);
  });

  loadCourse().then(course => {
    if (course) {
      const module = course.modules.find(m => m.id === modId && m.type === 'audio');
      renderModule(module);
    }
  });
</script>
</body>
</html>